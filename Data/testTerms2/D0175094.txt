#大数据/gi技术/gi系列----副本/nz更新/gi策略/gi
副本/n更新/gi策略/gi通常/d情况/n，/w大规模/b分布式存储/gi系统/gi会/v将/d一份/nz数据/gi在/p系统/gi内/f复制/gi多/a份/q并/cc保存/gi在/p不同/a的/ude1存储/gi。/w一方面/c可以/v通过/p数据/gi冗余/n来/vf增加/v系统/gi的/ude1可用性/gi，/w另一方面/c也/d可以/v增加/v读/v操作/gi的/ude1并发/gi程度/n。/w在/p多/a副本/n的/ude1情况下/nz，/w有/vyou3/nz种/q可能/v的/ude1更新/gi策略/gi：/w同时/c更新/gi策略/gi、/w主从/gi式/k更新/gi策略/gi和/cc任意/d节点/gi更新/gi策略/gi。/w同时/c更新/gi多/a副本/n更新/gi主要/b有/vyou以下/f2/nz种/q情形/n：/w /x类型/gi1/nz：/w不/d通过/p一致性/gi协议/gi不/d通过/p任何/rz一致性/gi协议/gi直接/ad同时/c更新/gi多/a个/q副本/n数据/gi。/w这种/r情形/n存在/v法硕/nz的/ude1数据/gi一致性/gi问题/gi：/w如果/c同一/b时刻/n两/nz个/q不同/a的/ude1客户端/gi对/p这个/rz数据/gi同时/c发出/vupdate/gi1/nz和/ccupdate/gi2/nz更新/gi请求/gi，/w那么/c系统/gi会/v无法/v确定/v其/rz执行/v顺序/gi，/w这样/rzv会/v在/p有的/rz副本/n中/f，/w执行/v顺序/gi是/vshiupdate/gi1/nzC/nzupdate/gi2/nz；/w而/cc在/p有的/rz副本/n中/f，/w执行/v顺序/gi是/vshiupdate/gi2/nzC/nzupdate/gi1。/nz类型/gi2/nz：/w一致性/gi协议/gi预先/d处理/vn通过/p某种/rz一致性/gi协议/gi来/vf预先/d处理/vn，/w这种/r处理/vn可以/v用来/v唯一/b确定/v不同/a更新/gi操作/gi的/ude1顺序/gi。/w这样/rzv可以/v保证数据/n的/ude1一致性/gi，/w但是/c由于/p协议/gi本身/rz会/v有/vyou处理/vn成本/n，/w从而/c会/v增加/v请求/gi延时/v。/w主从/gi式/k更新/gi策略/gi如果/c在/p多/a个/q副本/n中/f有/vyou一个/mq主/ag副本/n，/w其他/rzv副本/n为/p从/p副本/n，/w这种/r情况下/nz称/v为主/vi从/p式/k更新/gi策略/gi。/w所有/b对/p这个/rz数据/gi的/ude1更新/gi操作/gi会/v首先/d提交/gi到/v主/ag副本/n，/w再/d由/p主/ag副本/n通知/gi从/p副本/n进行/vn数据/gi更新/gi。/w如果/c有/vyou多/a个/q数据/gi更新/gi操作/gi需要/v处理/vn，/w主/ag副本/n会/v决定/v不同/a更新/gi操作/gi的/ude1执行/v顺序/gi，/w其他/rzv从/p副本/n也/d遵循/gi主/ag副本/n的/ude1更新/gi顺序/gi。/w根据/p主/ag副本/n通知/gi从/p副本/n的/ude1不同/a机制/gi，/w可以/v分为/v三种/nz类型/gi：/w类型/gi1/nz：/w同步/gi方式/n主/ag副本/n等待/gi所有/b从/p副本/n更新/gi完成/v后/f才/d确认/v更新/gi操作/gi完成/v。/w这种/r方式/n可以/v保证数据/n的/ude1强/a一致性/gi，/w但是/c会/v存在/v较大/d的/ude1请求/gi延时/v，/w尤其/d是/vshi当/p副本/n跨/v数据中心/gi的/ude1时候/n，/w因为/c请求/gi延时/v取决于/v更新/gi操作/gi最慢/nz的/ude1那/rzv一个/mq副本/n的/ude1速度/n。/w类型/gi2/nz：/w异步/gi方式/n主/ag副本/n通知/gi从/p副本/n更新/gi之前/f即可/v确认/v更新/gi操作/gi。/w这种/r情况下/nz，/w如果/c主/ag副本/n还/d没有/v通知/gi其他/rzv从/p副本/n就/d发生/v崩溃/vi，/w那么/c就/d会/v影响/gi到/v数据/gi的/ude1一致性/gi，/w所以/c一般/ad会/v先/d在/p另外/c的/ude1可靠/a存储/gi位置/gi将/d这次/r更新/gi操作/gi记录下来/l，/w以免/c发生意外/l。/w在/p异步/gi方式/n中/f，/w如何/ryv权衡/v请求/gi延时/v和/cc数据/gi一致性/gi取决于/v对读/v操作/gi的/ude1响应/v方式/n，/w根据/p读/v操作/gi的/ude1响应/v方式/n，/w可以/v分为/v如下/vi2/nz种/q情况/n：/w如果/c所有/b读/v请求/gi都/d必须/d通过/p主副/nz本来/d响应/v，/w也/d就是说/c，/w任何/rz一个/mq从/p副本/n在/p接收/gi到/v读/v请求/gi后/f都/d要/v将/d该/rz请求/gi转发给/v主/ag副本/n。/w这种/r情况下/nz数据/gi的/ude1一致性/gi可以/v保障/vn，/w但是/c无疑/d会/v增加/v请求/gi延时/v。/w因为/c当/p一个/mq客户端/gi发出/v读/v操作/gi请求/gi时/qt，/w原本/d可以/v由/p距离/gi这个/rz客户端/gi最近/t的/ude1从/p副本/n响应/v请求/gi，/w现在/t则/d需要/v将/d这个/rz请求/gi转发给/v距离/gi较远/d的/ude1主/ag副本/n。/w如果/c任意/d一个/mq从/p副本/n都/d可以/v响应/v请求/gi，/w这种/r情况下/nz会/v降低/v延时/v，/w但是/c数据/gi一致性/gi无法/v保证/v，/w因为/c有些/rz副本/n还/d可能/v存在/v着/uzhe旧版本/ns的/ude1数据/gi信息/gi。/w类型/gi3/nz：/w混合/vn方式/n也/d可/v采用/v同步/gi、/w异步/gi混合/vn的/ude1方式/n：/w主/ag副本/n先/d同步/gi更新/gi部分/n从/p副本/n数据/gi，/w然后/c即可/v确认/v更新/gi操作/gi完成/v，/w其他/rzv副本/n通过/p异步/gi方式/n进行/vn更新/gi。/w在/p这种/r情况下/nz，/w请求/gi延时/v和/cc数据/gi一致性/gi之间/f的/ude1权衡/v也/d取决于/v读/v操作/gi的/ude1响应/v方式/n：/w如果/c一个/mq读/v操作/gi的/ude1数据/gi至少/d要/v从/p一个/mq同步/gi更新/gi的/ude1节点/gi中/f读出/v，/w则/d强/a一致性/gi可以/v获得/v保证/v，/w但/c与此同时/c请求/gi延时/v会/v增加/v，/w因为/c不管/c两步/n方式/n还是/c异步/gi方式/n，/w请求/gi延时/v都会/n发生/v，/w而/cc由于/p其/rz涉及/v的/ude1节点/gi少于/v单一/gi的/ude1同步/gi方式/n和/cc异步/gi方式/n，/w所以/c延时/v的/ude1问题/gi没有/v那么/c严重/a。/w如果/c读/v操作/gi不/d要求/n一定/b要/v从/p至少/d一个/mq同步/gi更新/gi节点/gi读出/v，/w那么/c会/v出现/v异步/gi方式/n下第/v2/nz种/q情况/n中的/v数据/gi不/d一致/a问题/gi。/w任意/d节点/gi更新/gi策略/gi客户端/gi的/ude1数据/gi更新/gi请求/gi可能会/nz发给/v多/a副本/n中的/v任意/d一个/mq节点/gi，/w由/p这个/rz节点/gi负责/v通知/gi其他/rzv节点/gi进行/vn数据/gi更新/gi，/w这种/r方式/n与/cc“主/nz从/p式/k更新/gi”/w的/ude1区别/gi是/vshi：/w对于/p数据/gi的/ude1更新/gi操作/gi请求/gi，/w并不/d存在/v某个/rz指定/v的/ude1首先/d进行/vn响应/v的/ude1主/ag副本/n，/w而是/c任意/d一个/mq节点/gi都/d可以/v进行/vn响应/v。/w它/rr的/ude1特殊性/n在于/v：/w在/p同一/b时刻/n，/w有/vyou两/nz个/q不同/a的/ude1客户端/gi对/p同一/b数据/gi进行/vn更新/gi操作/gi请求/gi，/w而/cc此时/r有可能/nz有/vyou两/nz个/q不同/a的/ude1副本/n各自/rr响应/v。/w这种/r方式/n下/f的/ude1请求/gi延时/v和/cc数据/gi一致性/gi之间/f的/ude1权衡/v也/d有/vyou2/nz种/q情况/n：/w类型/gi1/nz：/w同步/gi通知/gi其他/rzv副本/n这种/r情况/n与/cc”主/nz从/p式/k更新/gi”/w中的/v类型/gi1/nz相似/a。/w此外/c，/w为了/p识别/gi出/vf是否/v存在/v客户端/gi同时/c更新/gi不同/a副本/n的/ude1情况/n，/w还/d需要/v付出/v更多/ad的/ude1请求/gi延时/v。/w类型/gi2/nz：/w异步/gi通知/gi其他/rzv副本/n这种/r情况/n与/cc”/w同时/c更新/gi策略/gi”/w及/cc”主/nz从/p式/k更新/gi策略/gi”/w的/ude1类型/gi2/nz相似/a。/w正常/a情况下/nz，/w”主/nz从/p式/k更新/gi”/w的/ude1类型/gi3/nz发挥作用/n，/w而/cc当/p主/ag副本/n发生/v故障/gi时/qt，/w”/w任意/d节点/gi更新/gi策略/gi”/w发挥作用/n。-_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nz_/nzstanding on shoulders of giants/nz